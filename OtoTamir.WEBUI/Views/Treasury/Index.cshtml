@model OtoTamir.WEBUI.Models.TreasuryDashboardViewModel
@{
    ViewData["Title"] = "Kasa ve Banka Yönetimi";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="row">
    <div class="col-lg-3 col-6">
        <div class="small-box bg-success">
            <div class="inner">
                <h3>@Model.Treasury.CashBalance.ToString("C2")</h3>
                <p>Nakit Kasa (Elden)</p>
            </div>
            <div class="icon">
                <i class="fas fa-wallet"></i>
            </div>
        </div>
    </div>
    <div class="col-lg-3 col-6">
        <div class="small-box bg-info">
            <div class="inner">
                <h3>@Model.Treasury.BankBalance.ToString("C2")</h3>
                <p>Toplam Banka Varlığı</p>
            </div>
            <div class="icon">
                <i class="fas fa-university"></i>
            </div>
        </div>
    </div>
    <div class="col-lg-3 col-6">
        <div class="small-box bg-warning">
            <div class="inner">
                <h3>@Model.Treasury.ReceivablesBalance.ToString("C2")</h3>
                <p>Toplam Alacak (Veresiye)</p>
            </div>
            <div class="icon">
                <i class="fas fa-book-open"></i>
            </div>
        </div>
    </div>
    <div class="col-lg-3 col-6">
        <div class="small-box bg-secondary">
            <div class="inner">
                <h3>@((Model.Treasury.CashBalance + Model.Treasury.BankBalance).ToString("C2"))</h3>
                <p>Toplam Hazır Değer</p>
            </div>
            <div class="icon">
                <i class="fas fa-chart-pie"></i>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-6">
        <div class="card card-primary card-outline">
            <div class="card-header">
                <h3 class="card-title"><i class="fas fa-university mr-1"></i> Banka Hesapları</h3>
                <div class="card-tools">
                    <button type="button" class="btn btn-tool" data-bs-toggle="modal" data-bs-target="#modalAddBank">
                        <i class="fas fa-plus"></i> Ekle
                    </button>
                </div>
            </div>
            <div class="card-body p-0">
                <table class="table table-striped table-sm">
                    <thead>
                        <tr>
                            <th>Banka Adı</th>
                            <th>IBAN / Hesap No</th>
                            <th class="text-right">Bakiye</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var bank in Model.Banks)
                        {
                            <tr>
                                <td>@bank.BankName</td>
                                <td><small>@bank.Iban</small></td>
                                <td class="text-right font-weight-bold">@bank.Balance.ToString("C2")</td>
                                <td class="text-right">
                                    <form asp-action="DeleteBank" method="post" style="display:inline;">
                                        <input type="hidden" name="id" value="@bank.Id" />
                                        <button type="submit" class="btn btn-xs btn-danger" onclick="return confirm('Silmek istediğine emin misin?')"><i class="fas fa-trash"></i></button>
                                    </form>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="col-md-6">
        <div class="card card-warning card-outline">
            <div class="card-header">
                <h3 class="card-title"><i class="fas fa-credit-card mr-1"></i> Kredi Kartları / POS</h3>
                <div class="card-tools">
                    <button type="button" class="btn btn-tool" data-bs-toggle="modal" data-bs-target="#modalAddCard">

                        <i class="fas fa-plus"></i> Ekle
                    </button>

                </div>
            </div>
            <div class="card-body p-0">
                <table class="table table-striped table-sm">
                    <thead>
                        <tr>
                            <th>Kart Adı</th>
                            <th>Bağlı Banka</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var card in Model.BankCards)
                        {
                            <tr>
                                <td>@card.CardName</td>
                                <td>
                                    @{
                                        var linkedBank = Model.Banks.FirstOrDefault(b => b.Id == card.BankId);
                                        <span>@(linkedBank != null ? linkedBank.BankName : "-")</span>
                                    }
                                </td>
                                <td class="text-right">
                                    <form asp-action="DeleteCard" method="post" style="display:inline;">
                                        <input type="hidden" name="id" value="@card.Id" />
                                        <button type="submit" class="btn btn-xs btn-danger" onclick="return confirm('Silmek istediğine emin misin?')"><i class="fas fa-trash"></i></button>
                                    </form>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header border-0">
                <h3 class="card-title">Son Kasa Hareketleri</h3>
            </div>
            <div class="card-body table-responsive p-0">
                <table class="table table-striped table-valign-middle">
                    <thead>
                        <tr>
                            <th>Tarih</th>
                            <th>Açıklama</th>
                            <th>Yapan</th>
                            <th>Kaynak</th>
                            <th class="text-right">Tutar</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model.Transactions)
                        {
                            <tr>
                                <td>@item.TransactionDate.ToString("dd.MM.yyyy HH:mm")</td>
                                <td>@item.Description</td>
                                <td>@item.AuthorName</td>
                                <td>
                                    @if (item.PaymentSource == OtoTamir.CORE.Entities.PaymentSource.Cash)
                                    {
                                        <span class="badge badge-success">Nakit</span>
                                    }
                                    else if (item.PaymentSource == OtoTamir.CORE.Entities.PaymentSource.Bank)
                                    {

                                        <span class="badge badge-info">Banka</span>
                                    }
                                    else
                                    {

                                        <span class="badge badge-warning">Veresiye</span>
                                    }
                                </td>
                                <td class="text-right font-weight-bold @(item.TransactionType == OtoTamir.CORE.Entities.TransactionType.Incoming ? "text-success" : "text-danger")">
                                    @(item.TransactionType == OtoTamir.CORE.Entities.TransactionType.Incoming ? "+" : "-") @item.Amount.ToString("C2")
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="modalAddBank" tabindex="-1" aria-hidden="true">
    @await Component.InvokeAsync("_AddBankViewComponentPartial")
</div>

<div class="modal fade" id="modalAddCard" tabindex="-1" aria-hidden="true">
    @await Component.InvokeAsync("_AddBankCardViewComponentPartial")
</div>